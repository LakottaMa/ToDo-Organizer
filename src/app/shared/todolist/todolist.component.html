<main>
    <section>
        <mat-accordion>
            @for (todo of todoService.filteredTodos(); track todo.id) {
            <mat-expansion-panel>
                <mat-expansion-panel-header>
                    <mat-panel-title>{{ todo.title }}</mat-panel-title>
                </mat-expansion-panel-header>
                <form [formGroup]="editForms[todo.id!]" class="form">
                    <mat-form-field class="form-field" appearance="outline">
                        <mat-label>Title</mat-label>
                        <input matInput formControlName="title">
                    </mat-form-field>
                    <mat-form-field class="form-field" appearance="outline">
                        <mat-label>Description</mat-label>
                        <textarea matInput formControlName="description"></textarea>
                    </mat-form-field>
                    <div class="field-pair">
                        <mat-form-field class="form-field-pair" appearance="outline">
                            <mat-label>Due Date</mat-label>
                            <input matInput formControlName="dueDate" [matDatepicker]="picker" (focus)="picker.open()">
                            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                            <mat-datepicker #picker></mat-datepicker>
                        </mat-form-field>
                        <mat-form-field class="form-field-pair" appearance="outline">
                            <mat-label>Priority</mat-label>
                            <mat-select formControlName="priority">
                                <mat-option value="low">Low</mat-option>
                                <mat-option value="medium">Medium</mat-option>
                                <mat-option value="high">High</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div class="field-pair">
                        <mat-form-field class="form-field-pair" appearance="outline">
                            <mat-label>Category</mat-label>
                            <mat-select formControlName="category">
                                <mat-option value="private">Private</mat-option>
                                <mat-option value="study">Study</mat-option>
                                <mat-option value="work">Work</mat-option>
                            </mat-select>
                        </mat-form-field>
                        <mat-form-field class="form-field-pair" appearance="outline">
                            <mat-label>Status</mat-label>
                            <mat-select formControlName="status">
                                <mat-option value="pending">Pending</mat-option>
                                <mat-option value="in progress">In Progress</mat-option>
                                <mat-option value="done">Done</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div class="form-buttons">
                        <button type="button" mat-raised-button color="primary" (click)="onUpdate(todo)">Update</button>
                        <button type="button" mat-raised-button color="warn" (click)="onDelete(todo)">Delete</button>
                    </div>
                </form>
            </mat-expansion-panel>
        } @empty {
            <p>No todos found.</p>
          }
        </mat-accordion>
    </section>
</main>